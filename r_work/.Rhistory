return(folders_df)
} else {
parent_ids <- orphans$parent %>%
paste(collapse = ",") %>%
unique()
q <- paste0(
"SELECT id, name, parent, project_id
FROM folder
WHERE id in (", parent_ids, ")"
)
parents <- dbGetQuery(con, q)
temp_folders <- rbind(folders_df, parents)
return(get_parents(temp_folders))
}
}
all_folders <- get_parents(file_folders)
sample_n(all_folders, 5)
create_paths <- function(folders_df) {
for (i in nrow(folders_df):1) {
if (is.na(folders_df$parent[i])) {
folders_df$path[i] <- folders_df$name[i]
} else {
parent_name <- folders_df$name[folders_df$id == folders_df$parent[i]]
folders_df$path[i] <- paste0(parent_name, "/", folders_df$name[i], "/")
}
}
}
all_f2 <- create_paths(all_folders)
create_paths <- function(folders_df) {
for (i in 1:nrow(folders_df)) {
if (is.na(folders_df$parent[i])) {
folders_df$path[i] <- folders_df$name[i]
} else {
parent_name <- folders_df$name[folders_df$id == folders_df$parent[i]]
folders_df$path[i] <- paste0(parent_name, "/", folders_df$name[i], "/")
}
}
}
all_f2 <- create_paths(all_folders)
names(all_folders)
folders_df$path[i] <- folders_df$name[i]
create_paths <- function(folders_df) {
for (i in 1:nrow(folders_df)) {
if (is.na(folders_df$parent[i])) {
folders_df$path[i] <- folders_df$name[i]
} else {
parent_name <- folders_df$name[folders_df$id == folders_df$parent[i]]
folders_df$path[i] <- paste0(parent_name, "/", folders_df$name[i], "/")
}
}
}
all_f2 <- create_paths(all_folders)
sample_n(all_folders, 5)
all_folders[1:10]
all_folders[1:10,]
all_folders[10:25,]
all_folders[50:75,]
all_folders[200:225,]
all_folders[2000:2205,]
names(all_docs)
names(all_docs)
names(all_folders)
names(all_docs)[1] <- "file_id"
names(all_docs)
names(all_folders)
names(all_folders)[1:2] <- c("folder_id", "folder_name")
names(all_folders)
names(all_folders)[3] <- "parent_id"
names(all_folders)
docs_w_folders <- all_docs %>%
left_join(all_folders, by = c("folder_id" = "folder_id")) %>%
select(project_id, project_name, folder_id, folder_name, file_name, file_bytes, mimetype, parent_id)
names(all_docs)
names(all_folders)
docs_w_folders <- all_docs %>%
left_join(all_folders, by = c("folder_id" = "folder_id"))# %>%
#select(project_id, project_name, folder_id, folder_name, file_name, file_bytes, mimetype, parent_id)
names(docs_w_folders)
docs_w_folders <- all_docs %>%
left_join(all_folders, by = c("folder_id" = "folder_id")) %>%
select(project_id.x, folder_id, folder_name, file_name, bytes, mimetype, parent_id)
docs_w_folders <- all_docs %>%
left_join(all_folders, by = c("folder_id" = "folder_id")) %>%
select(project_id.x, folder_id, folder_name, filename, bytes, mimetype, parent_id)
length(unique(docs_w_folders$folder_id))
names(all_folders)
# create paths in all_folders table
all_folders$path <- NA
create_paths(all_folders)[1:20,]
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i]) && is.na(folders_df$path[i])){
folders_df$path[i] <- folders_df$folder_name[i]
} else if (!is.na(folders_df$parent_id[i]) && is.na(folders_df$path[i])){
folders_df$path[i] <- folders_df$folder_name[i]
} else {
parent <- folders_df$folder_name[folders_df$parent_id[i]]
folders_df$path[i] <- paste0(parent, "/", folders_df$path[i])
}
}
}
create_paths(all_folders)[1:20,]
create_paths(all_folders)
get_parent_info <- function(folders_df, parents_id){
parent_info <- folders_df %>%
filter(folder_id == parents_id)
if (is.na(parent_info$parent_id)){
break
} else {
parent_deets <- folders_df %>%
filter(parent_id == folder_id) %>%
select(folder_id, folder_name, parent_id)
return(parent_deets)
}
}
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name, "/", folders_df$path[i])
parent_info <- get_parent_info(folders_df, parent_info$parent_id)
}
}
}
all_f2 <- create_paths(all_folders)
# get project names
is.na(all_folders$parent_id)[1:25]
# get project names
!is.na(all_folders$parent_id)[1:25]
get_parent_info <- function(folders_df, parents_id){
parent_deets <- folders_df %>%
filter(parent_id == folder_id) %>%
select(folder_id, folder_name, parent_id)
if (is.na(parent_deets$parent_id)){
break
} else {
return(parent_deets)
}
}
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name, "/", folders_df$path[i])
parent_info <- get_parent_info(folders_df, parent_info$parent_id)
}
}
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name, "/", folders_df$path[i])
parent_info <- get_parent_info(folders_df, parent_info$parent_id)
}
}
}
get_parent_info <- function(folders_df, parents_id){
parent_deets <- folders_df %>%
filter(parent_id == folder_id) %>%
select(folder_id, folder_name, parent_id)
if (is.na(parent_deets$parent_id)){
break
} else {
return(parent_deets)
}
}
all_f2 <- create_paths(all_folders)
all_folders$parent_id[235]
get_parent_info(all_folders, all_folders$parent_id[235])
all_folders$parent_id[2350]
get_parent_info(all_folders, all_folders$parent_id[2350])
get_parent_info <- function(folders_df, parents_id){
parent_deets <- folders_df %>%
filter(folder_id == parents_id) %>%
select(folder_id, folder_name, parent_id)
if (is.na(parent_deets$parent_id)){
break
} else {
return(parent_deets)
}
}
get_parent_info(all_folders, all_folders$parent_id[2350])
all_folders$parent_id[2350]
get_parent_info(all_folders, all_folders$parent_id[235])
get_parent_info <- function(folders_df, parents_id){
parent_deets <- folders_df %>%
filter(folder_id == parents_id) %>%
select(folder_id, folder_name, parent_id)
if (is.na(parent_deets$parent_id)){
break
} else {
return(parent_deets)
}
}
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name, "/", folders_df$path[i])
parent_info <- get_parent_info(folders_df, parent_info$parent_id)
}
}
}
all_f2 <- create_paths(all_folders)
get_parent_info <- function(folders_df, parents_id){
parent_deets <- folders_df %>%
filter(folder_id == parents_id) %>%
select(folder_id, folder_name, parent_id)
return(parent_deets)
}
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name, "/", folders_df$path[i])
parent_info <- get_parent_info(folders_df, parent_info$parent_id)
}
}
}
all_f2 <- create_paths(all_folders)
get_parent_info <- function(folders_df, parents_id){
parent_deets <- folders_df %>%
filter(folder_id == parents_id) %>%
select(folder_id, folder_name, parent_id)
return(parent_deets)
}
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name, "/", folders_df$path[i])
parent_info <- get_parent_info(folders_df, parent_info$parent_id)
}
}
}
all_f2 <- create_paths(all_folders)
# create paths in all_folders table
sample_n(all_folders, 10)
View(all_folders)
all_f2 <- all_folders %.%
mutate(path =
ifelse(is.na(parent_id), folder_name, paste0(all_folders[folder_id==parent_id]$folder_name, "/", path)))
all_f2 <- all_folders %>%
mutate(path =
ifelse(is.na(parent_id), folder_name, paste0(all_folders[folder_id==parent_id]$folder_name, "/", path)))
f <- NA
paste0("startle", "/", f)
get_parent_info <- function(parents_id){
parent_deets <- folders_df[folders_df$folder_id == parents_id]
return(parent_deets)
}
get_parent_info <- function(parents_id){
parent_deets <- folders_df[folders_df$folder_id == parents_id]
return(parent_deets)
}
for (i in 1:nrow(all_folders)){
if (is.na(all_folders$parent_id[1])){
next
}
else {
parent_info <- get_parent_info(all_folders$parent_id[i])
while(!is.na(parent_info$parent_id)){
path <- paste0(parent_info$folder_name,"/",path)
parent_info <- get_parent_info[i]
}
}
}
# create paths in all_folders table
sample_n(all_folders, 10)
for (i in 1:nrow(all_folders)){
if (is.na(all_folders$parent_id[i])){
next
}
else {
parent_info <- get_parent_info(all_folders$parent_id[i])
while(!is.na(parent_info$parent_id)){
path <- paste0(parent_info$folder_name,"/",path)
parent_info <- get_parent_info[i]
}
}
}
parent_deets <- folders_df[folders_df$folder_id == parents_id]
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
else {
parent_info <- get_parent_info(folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
path <- paste0(parent_info$folder_name,"/",path)
parent_info <- get_parent_info[i]
}
}
}
}
get_parent_info <- function(folders_df, parents_id){
parent_deets <- folders_df[folders_df$folder_id == parents_id]
return(parent_deets)
}
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
else {
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
path <- paste0(parent_info$folder_name,"/",path)
parent_info <- get_parent_info[i]
}
}
}
}
all_f2 <- create_paths(all_folders)
names(all_folders)
get_parent_info <- function(folders_df, parents_id){
parent_deets <- folders_df[folders_df$folder_id == parents_id,]
return(parent_deets)
}
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
else {
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
path <- paste0(parent_info$folder_name,"/",path)
parent_info <- get_parent_info[i]
}
}
}
}
all_f2 <- create_paths(all_folders)
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
else {
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name,"/",folders_id$path[i])
parent_info <- get_parent_info[i]
}
}
}
}
all_f2 <- create_paths(all_folders)
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
else {
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name,"/",folders_df$path[i])
parent_info <- get_parent_info[i]
}
}
}
}
all_f2 <- create_paths(all_folders)
create_paths <- function(folders_df){
for (i in 1:nrow(folders_df)){
if (is.na(folders_df$parent_id[i])){
next
}
else {
parent_info <- get_parent_info(folders_df, folders_df$parent_id[i])
while(!is.na(parent_info$parent_id)){
folders_df$path[i] <- paste0(parent_info$folder_name,"/",folders_df$path[i])
parent_info <- get_parent_info(folders_df, parent_info)
}
}
}
}
all_f2 <- create_paths(all_folders)
unique()
unique_folders <- all_folders %>%
select(folder_id, parent_id) %>%
unique()
remove(unique_folders)
length(unique(folders_df$folder_id))
length(unique(all_folders$folder_id))
folder_goofin <- all_folders %>%
select(folder_id, project_id)
new_col <- "parent2"
all_f2$new_col <- NA
names(all_f2)
while(!(is.na(all(folder_goofin[,ncol(folder_goofin)])))){
col_num <- ncol(folder_goofin)+1
for (i in 1:nrow(folder_goofin)){
new_col <- paste0("parent", col_num)
folder_goofin[paste0("parent", col_num)][i] <-
folder_goofin %>% filter(folder_id == folder_goofin$parent_id[i])
}
}
for (i in 1:nrow(folder_goofin)){
if (is.na(folder_goofin$parent_id[i])){
folder_goofin[paste0("parent", col_num)][i] <- NA
}
else {
folder_goofin[paste0("parent", col_num)][i] <-
folder_goofin %>% filter(folder_id == folder_goofin$parent_id[i])
}
}
for (i in 1:nrow(folder_goofin)){
if (!is.na(folder_goofin$parent_id[i])){
folder_goofin[paste0("parent", col_num)][i] <-
folder_goofin %>% filter(folder_id == folder_goofin$parent_id[i])
}
else {
folder_goofin[paste0("parent", col_num)][i] <- NA
}
}
while(!(is.na(all(folder_goofin[,ncol(folder_goofin)])))){
col_num <- ncol(folder_goofin)+1
for (i in 1:nrow(folder_goofin)){
if (!is.na(folder_goofin$parent_id[i])){
folder_goofin[paste0("parent", col_num)][i] <-
folder_goofin %>% filter(folder_id == folder_goofin$parent_id[i])
}
else {
folder_goofin[paste0("parent", col_num)][i] <- NA
}
}
}
names(folder_goofin)
folder_goofin <- all_folders
while(!(is.na(all(folder_goofin[,ncol(folder_goofin)])))){
col_num <- ncol(folder_goofin)+1
for (i in 1:nrow(folder_goofin)){
if (!is.na(folder_goofin$parent_id[i])){
folder_goofin[paste0("parent", col_num)][i] <-
folder_goofin %>% filter(folder_id == folder_goofin$parent_id[i])
}
else {
folder_goofin[paste0("parent", col_num)][i] <- NA
}
}
}
names(folder_goofin)
while(!(is.na(all(folder_goofin[,ncol(folder_goofin)])))){
print(names(folder_goofin))
col_num <- ncol(folder_goofin)+1
for (i in 1:nrow(folder_goofin)){
if (!is.na(folder_goofin$parent_id[i])){
folder_goofin[paste0("parent", col_num)][i] <-
folder_goofin %>% filter(folder_id == folder_goofin$parent_id[i])
}
else {
folder_goofin[paste0("parent", col_num)][i] <- NA
}
}
}
folder_goofin <- all_folders %>%
select(folder_id, folder_name, project_id, parent_id, )
while(!(is.na(all(folder_goofin[,ncol(folder_goofin)])))){
print(names(folder_goofin))
col_num <- ncol(folder_goofin)+1
for (i in 1:nrow(folder_goofin)){
if (!is.na(folder_goofin$parent_id[i])){
folder_goofin[paste0("parent", col_num)][i] <-
folder_goofin %>% filter(folder_id == folder_goofin$parent_id[i])
}
else {
folder_goofin[paste0("parent", col_num)][i] <- NA
}
}
}
folder_goofin <- folder_goofin[,ncol(folder_goofin)]
folder_goofin <- all_folders %>%
select(folder_id, folder_name, project_id, parent_id, )
folder_goofin[,ncol(folder_goofin)]
while(!(is.na(all(folder_goofin[,ncol(folder_goofin)])))){
print(names(folder_goofin))
col_num <- ncol(folder_goofin)+1
for (i in 1:nrow(folder_goofin)){
if (!is.na(folder_goofin$parent_id[i])){
folder_goofin[paste0("parent", col_num)][i] <-
folder_goofin %>% filter(folder_id == folder_goofin$parent_id[i])
}
else {
folder_goofin[paste0("parent", col_num)][i] <- NA
}
}
}
all(folder_goofin[,ncol(folder_goofin)])
typeof(folder_goofin[,ncol(folder_goofin)])
folder_goofin[,ncol(folder_goofin)]
vector(folder_goofin[,ncol(folder_goofin)])
list(folder_goofin[,ncol(folder_goofin)])
is.na(all(list(folder_goofin[,ncol(folder_goofin)])))
is.na(any(folder_goofin[,ncol(folder_goofin)]))
!is.na(any(folder_goofin[,ncol(folder_goofin)]))
